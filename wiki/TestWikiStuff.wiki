{{{
@ApiMethod(
    httpMethod = "GET",
  name = "user.list", 
  path = "user/list")
@SuppressWarnings({ "cast", "unchecked" })
public CollectionResponse<User> listUser(@Nullable @Named("cursor") String cursorString,
  @Nullable @Named("limit") Integer limit, com.google.appengine.api.users.User guser) throws Exception {
if (guser == null) {
  throw new UnauthorizedException(CustomErrors.MUST_LOG_IN.toString());
}
  
  PersistenceManager pm = null;
  Cursor cursor = null;
  List<User> execute = null;
  try {
    pm = getPersistenceManager();
    Query query = pm.newQuery(User.class);

    if (cursorString != null && cursorString != "") {
      cursor = Cursor.fromWebSafeString(cursorString);
      Map<String, Object> extensionMap = new HashMap<String, Object>();
      extensionMap.put(JDOCursorHelper.CURSOR_EXTENSION, cursor);
      query.setExtensions(extensionMap);
    }

    if (limit != null) {
      query.setRange(0, limit);
    }

    execute = (List<User>) query.execute();
    cursor = JDOCursorHelper.getCursor(execute);

    if (cursor != null) {
      cursorString = cursor.toWebSafeString();
    } else {
      cursorString = "";
    }

    execute.size();
  } finally {
    pm.close();
  }

  return CollectionResponse.<User> builder().setItems(execute).setNextPageToken(cursorString).build();
}
}}}